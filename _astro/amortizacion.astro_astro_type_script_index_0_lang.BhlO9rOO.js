import{E as B,a as S,C as R}from"./jspdf.plugin.autotable.BcsPjRKA.js";function F(){const C=[{display:"loanAmountFormatted",hidden:"loanAmount"},{display:"extraMonthlyFormatted",hidden:"extraMonthly"},{display:"extraAnnualFormatted",hidden:"extraAnnual"}],A=["loanTerm","interestRate","currency"],n={};C.forEach(t=>{const e=document.getElementById(t.display),s=document.getElementById(t.hidden);!e||!s||(n[t.hidden]=s,e.addEventListener("input",d=>{const c=d.target;let a=c.value.replace(/,/g,"");isNaN(Number(a))&&(a="0"),s.value=a,a!==""&&(c.value=Number(a).toLocaleString("en-US")),x()}))}),A.forEach(t=>{const e=document.getElementById(t);e&&(n[t]=e,e.addEventListener("input",x))});let u=null;function l(t){const e=n.currency.value;return e==="CRC"?"¢"+new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t):e==="USD"?"$"+new Intl.NumberFormat("en-US",{maximumFractionDigits:0}).format(t):new Intl.NumberFormat("en-US",{style:"currency",currency:e,maximumFractionDigits:0}).format(t)}function M(){const t=document.getElementById("lineChart");if(!t)return;const e=t.getContext("2d");e&&(u=new R(e,{type:"line",data:{labels:[],datasets:[{label:"Original",data:[],borderColor:"#e2e8f0",borderWidth:2,pointRadius:0,fill:!1,tension:.3,borderDash:[5,5]},{label:"Acelerado",data:[],borderColor:"#17A34A",borderWidth:3,pointRadius:0,fill:!0,backgroundColor:"rgba(124, 228, 149, 0.03)",tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{ticks:{font:{family:"Poppins",size:9},color:"#9ca3af"},grid:{color:"#f1f5f9"}},x:{ticks:{font:{family:"Poppins",size:9},color:"#9ca3af"},grid:{display:!1}}}}}))}function v(t,e,s,d,c){const a=e/100/12,m=s*12,y=t*a*Math.pow(1+a,m)/(Math.pow(1+a,m)-1);let o=t,f=0,r=0,g=[],h=[t],p=0,i=0;for(;o>.01&&r<600;){r++;let b=o*a,D=y-b,w=d+(r%12===0?c:0),E=Math.min(o,D+w);if(f+=b,o-=E,p+=b,i+=E,h.push(o),(r%12===0||o<=0)&&(g.push({year:Math.ceil(r/12),interest:p,capital:i,balance:Math.max(0,o)}),p=0,i=0),o<=0)break}return{totalInt:f,totalCost:t+f,basePayment:y,months:r,yData:g,balances:h}}function x(){const t=parseFloat(n.loanAmount?.value)||0,e=parseFloat(n.loanTerm?.value)||0,s=parseFloat(n.interestRate?.value)||0,d=parseFloat(n.extraMonthly?.value)||0,c=parseFloat(n.extraAnnual?.value)||0;if(t<=0||e<=0)return;const a=v(t,s,e,0,0),m=v(t,s,e,d,c),y=document.getElementById("monthlyPaymentDisplay"),o=document.getElementById("stdInterest"),f=document.getElementById("stdTotal"),r=document.getElementById("savingsAmount"),g=document.getElementById("timeSaved"),h=document.getElementById("amortizationTableBody");y&&(y.textContent=l(a.basePayment)),o&&(o.textContent=l(a.totalInt)),f&&(f.textContent=l(a.totalCost)),r&&(r.textContent=l(a.totalInt-m.totalInt));const p=a.months-m.months;g&&(g.textContent=`${Math.floor(p/12)} años, ${p%12} m`),u&&(u.data.labels=Array.from({length:Math.max(a.balances.length,m.balances.length)},(i,b)=>Math.ceil(b/12)),u.data.datasets[0].data=a.balances,u.data.datasets[1].data=m.balances,u.update()),h&&(h.innerHTML=m.yData.map(i=>`
          <tr class="hover:bg-gray-50 transition-colors">
            <td class="px-8 py-5 font-bold text-gray-900">${i.year}</td>
            <td class="px-8 py-5 text-gray-500">${l(i.interest)}</td>
            <td class="px-8 py-5 text-gray-500">${l(i.capital)}</td>
            <td class="px-8 py-5 font-bold text-gray-900">${l(i.balance)}</td>
          </tr>
        `).join(""))}async function P(){const t=new B("p","mm","a4"),e=n.currency.value;t.setFont("helvetica","bold"),t.setFontSize(22),t.text("Plan de pago anticipado",20,30),t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`RIP Wallet | www.ripwallet.co - ${new Date().toLocaleDateString()}`,20,38),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Configuración del Préstamo",20,55);const s=[["Moneda",e==="USD"?"$":e==="CRC"?"¢":e],["Monto Inicial",l(parseFloat(n.loanAmount.value))],["Plazo Original",`${n.loanTerm.value} años`],["Tasa de Interés",`${n.interestRate.value}%`],["Abono Mensual Extra",l(parseFloat(n.extraMonthly.value))],["Abono Anual Extra (Dic)",l(parseFloat(n.extraAnnual.value))]];S(t,{startY:60,body:s,theme:"plain",styles:{fontSize:9,cellPadding:2}});const d=document.getElementById("lineChart");if(d){const c=d.toDataURL("image/png",1);t.addPage(),t.setFontSize(14),t.text("Gráfico de Progreso de la Deuda",20,30),t.addImage(c,"PNG",20,40,170,100)}t.save(`RIP-Wallet-Plan-Amortizacion-${new Date().getTime()}.pdf`)}const I=document.getElementById("downloadPdf");I&&I.addEventListener("click",P),M(),x()}F();document.addEventListener("astro:page-load",F);
